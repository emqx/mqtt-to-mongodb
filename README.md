# mqtt-to-mongodb

Ingesting IoT data into MongoDB using MQTT and EMQX | MQTT MongoDB Integration

## Introduction

This tutorial will show you how to use MQTT to ingest IoT data into MongoDB. We will be using the [EMQX](https://www.emqx.io/) MQTT broker to publish and subscribe to messages. We will also be using the [MongoDB](https://mongodb.com/) database to store the data.

EMQX and MongoDB Complement Each Other in IoT Applications:

1. Real-time data processing: MongoDB efficiently stores and handles large volumes of real-time data generated by IoT devices, enabling fast read/write operations and queries.

2. Reliable message transmission: EMQX provides a reliable MQTT-based messaging platform for IoT, supporting bi-directional communication and publish/subscribe patterns between devices.

3. Flexible data modeling and querying: MongoDB's document data model and powerful query capabilities allow for flexible organization and retrieval of IoT data.

Reasons for using MongoDB + EMQX for the Internet of Things (IoT):

Real-time data processing: MongoDB efficiently stores and handles large volumes of real-time data generated by IoT devices, enabling fast read/write operations and queries.

Reliable message transmission: EMQX provides a reliable MQTT-based messaging platform for IoT, supporting bi-directional communication and publish/subscribe patterns between devices.

Flexible data modeling and querying: MongoDB's document data model and powerful query capabilities allow for flexible organization and retrieval of IoT data.

By combining MongoDB and EMQX, you can achieve real-time data processing, reliable message transmission, and flexible data management for IoT applications and solutions.

In this scenario, EMQX provides reliable logistics truck data collection and transmission capabilities, including vehicle location data, speed data, and vehicle status data.

At the same time, MongoDB is used as the data storage solution to store the vehicle status data into the database.

You can use visualization tools, such as Grafana, to present the vehicle location and status. In this way, you can monitor vehicle data for vehicle scheduling, operations monitoring, and data analysis. This scenario provides a real-time monitoring and data display solution for Telematics to help realize smarter and more efficient logistics vehicle management.

## Architecture

| Name      | Version | Description                                                                      |
| --------- | ------- | -------------------------------------------------------------------------------- |
| [EMQX Enterprise](https://www.emqx.com/en/products/emqx)      | 5.0.3+  | MQTT broker used for message exchange between MQTT clients and the MongoDB. |
| [MQTTX CLI](https://mqttx.app/cli) | 1.9.3+  | Command-line tool used to generate simulated data for testing.        |
| [MongoDB](https://mongodb.com/)     | 4.4.6+  | Storage of simulation data from logistics trucks      |

## How to use

<!-- 1. Init the submodule to get the EMQX Exporter  (Optional):

  ```bash
  git submodule init
  git submodule update
  ``` -->

1. Please make sure you have installed the [docker](https://www.docker.com/), and then running the following commands to start the demo:

  ```bash
  docker-compose up -d
  ```

2. Running the following commands to see the message from MQTTX:

  ```bash
  docker logs -f mqttx-sub
  ```

3. Run the following command to view the truck data in MongoDB:

  ```bash
  docker exec -it mongo mongo

  # switch to the iot_data database
  > use iot_data;
  switched to db iot_data

  # auth with the admin user
  > db.auth('admin', 'public')
  1

  # query data from the truck_data collection
  > db.truck_data.find();
  { "_id" : ObjectId("64b4dff9a59af20001000001"), "car_id" : "JK4LWAFDS5DZ18160", "direction" : 8, "display_name" : "car_1", "distance" : 28.6111111111, "doors_open" : false, "fuel_consumption" : 23.69, "inside_temp" : 34.8, "latitude" : 125.4242590552, "longitude" : 78.7727677446, "model" : "J7", "outside_temp" : 48.9, "power" : 61, "shift_state" : "D11", "speed" : 103, "state" : "moving", "timestamp" : ISODate("2023-07-17T06:30:17.598Z"), "windows_open" : true }
  ...
  ```

## License

[Apache License 2.0](./LICENSE)
